<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sri Vinayaga Laber Works</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        @media print {
            @page { margin: 1.5cm; size: a4; }
            body * { visibility: hidden !important; height: 0 !important; overflow: hidden !important; }
            #print-area, #print-area * { visibility: visible !important; height: auto !important; overflow: visible !important; }
            #print-area { position: absolute !important; left: 0 !important; top: 0 !important; width: 100% !important; display: block !important; }
        }
        select { -webkit-tap-highlight-color: transparent; outline: none; }
        input { outline: none; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

        window.fb = { initializeApp, getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, getAuth, signInAnonymously, onAuthStateChanged };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Custom SVG Icons to avoid Lucide external library conflicts
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                Package: <path d="M16.5 9.4 7.55 4.24a2 2 0 0 0-2 0L3.42 5.51a1.49 1.49 0 0 0 .23 2.65L12 13l8.35-4.84a1.49 1.49 0 0 0 .23-2.65L18.45 4.24a2 2 0 0 0-2 0L16.5 9.4Z"/><path d="m3.29 14.29 7.4 4.29a2 2 0 0 0 2 0l7.4-4.29a1.5 1.5 0 0 0 0-2.6l-7.4-4.29a2 2 0 0 0-2 0l-7.4 4.29a1.5 1.5 0 0 0 0 2.6Z"/><path d="M12 22v-9"/>,
                ChevronDown: <path d="m6 9 6 6 6-6"/>,
                ClipboardList: <rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/>,
                X: <path d="M18 6 6 18"/><path d="M6 6 18 18"/>,
                Plus: <path d="M12 5v14"/><path d="M5 12h14"/>,
                History: <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/>,
                Lock: <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>,
                Send: <path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        const PRODUCT_DATA = {
            pipes: [
                { size: 20, pieces: 40, rates: { "10 Kgs": 1.15, "15 Kgs": 1.20 } },
                { size: 25, pieces: 38, rates: { "10 Kgs": 1.44, "15 Kgs": 1.70 } },
                { size: 32, pieces: 30, rates: { "10 Kgs": 2.30, "15 Kgs": 2.50 } },
                { size: 40, pieces: 26, rates: { "6 Kgs": 2.50, "10 Kgs": 3.50, "15 Kgs": 3.50 } },
                { size: 50, pieces: 20, rates: { "6 Kgs": 4.00, "10 Kgs": 4.50, "15 Kgs": 4.50, "5 Bend": 6.10 } },
                { size: 63, pieces: 17, rates: { "4 Kgs": 5.00, "6 Kgs": 6.00, "5 Bend": 6.90 } },
                { size: 75, pieces: 15, rates: { "4 Kgs": 6.00, "6 Kgs": 7.00, "5 Bend": 8.70 } },
                { size: 90, pieces: 13, rates: { "4 Kgs": 8.00, "6 Kgs": 9.00, "5 Bend": 10.62 } },
                { size: 110, pieces: 11, rates: { "4 Kgs": 11.00, "6 Kgs": 12.65, "5 Bend": 12.65 } },
                { size: 140, pieces: 8, rates: { "4 Kgs": 65.00, "6 Kgs": 80.00, "5 Bend": 115.00 } },
                { size: 160, pieces: 6, rates: { "4 Kgs": 100.00, "6 Kgs": 115.00, "5 Bend": 172.50 } },
                { size: 180, pieces: 5, rates: { "4 Kgs": 170.00, "6 Kgs": 195.50 } },
                { size: 200, pieces: 5, rates: { "4 Kgs": 220.00, "6 Kgs": 245.50 } },
            ],
            jetFootvale: [
                { name: "50*6", rate: 25.00 },
                { name: "50*15", rate: 30.00 },
                { name: "50*32", rate: 30.00 },
                { name: "50*40", rate: 40.00 },
                { name: "63*6", rate: 40.00 },
            ],
            longCoupler: [
                { size: 32, rates: { "10 KG": 4.00, "15 KG": 5.00 } },
                { size: 40, rates: { "6 KG": 4.00, "10 KG": 5.00 } },
                { size: 50, rates: { "6 KG": 5.00 } },
                { size: 63, rates: { "4 KG": 6.50, "6 KG": 7.00 } },
                { size: 75, rates: { "4 KG": 7.50, "6 KG": 8.00 } },
                { size: 90, rates: { "4 KG": 8.50, "6 KG": 9.00 } },
                { size: 110, rates: { "4 KG": 9.50, "6 KG": 10.00 } },
                { size: 140, rates: { "4 KG": 15.50, "6 KG": 18.00 } },
                { size: 160, rates: { "4 KG": 18.50, "6 KG": 20.00 } },
            ]
        };

        const UI_TEXT = {
            en: {
                title: "SRI VINAYAGA LABER WORKS",
                subtitle: "Blessings of Sri Pachaiamman",
                pvcPipes: "PVC Bend",
                jetFootvale: "Jet Footvale",
                pipeSize: "Size",
                weight: "Type",
                add: "Add to Bill",
                grandTotal: "Grand Total",
                customerName: "Customer Name",
                generateBill: "Send Bill via WhatsApp",
                shop: "Shop",
                owner: "Records"
            },
            ta: {
                title: "ஸ்ரீ விநாயகா லேபர் ஒர்க்ஸ்",
                subtitle: "ஸ்ரீ பச்சையம்மன் துணை",
                pvcPipes: "PVC பெண்ட்",
                jetFootvale: "ஜெட் புட்வால்வ்",
                pipeSize: "அளவு",
                weight: "வகை",
                add: "பில்லில் சேர்க்க",
                grandTotal: "மொத்த தொகை",
                customerName: "வாடிக்கையாளர் பெயர்",
                generateBill: "பில் அனுப்பவும்",
                shop: "கடை",
                owner: "பதிவுகள்"
            }
        };

        function App() {
            const [lang, setLang] = useState('en');
            const [user, setUser] = useState(null);
            const [isAdminLoggedIn, setIsAdminLoggedIn] = useState(false);
            const [loginPassword, setLoginPassword] = useState('');
            const [cart, setCart] = useState([]);
            const [view, setView] = useState('shop');
            const [orders, setOrders] = useState([]);
            const [customerName, setCustomerName] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);

            const T = UI_TEXT[lang];

            const [selectedPipeSize, setSelectedPipeSize] = useState(PRODUCT_DATA.pipes[0].size);
            const [selectedPipeWeight, setSelectedPipeWeight] = useState(Object.keys(PRODUCT_DATA.pipes[0].rates)[0]);

            useEffect(() => {
                if (!window.fb) return;
                const { getAuth, signInAnonymously, onAuthStateChanged } = window.fb;
                const auth = getAuth();
                signInAnonymously(auth).catch(console.error);
                return onAuthStateChanged(auth, setUser);
            }, []);

            useEffect(() => {
                if (!window.fb || !user || !isAdminLoggedIn || view !== 'admin') return;
                const { getFirestore, collection, query, orderBy, onSnapshot } = window.fb;
                const db = getFirestore();
                const q = query(collection(db, 'artifacts', 'sri-vinayaga-laber-works-v1', 'public', 'data', 'orders'), orderBy('createdAt', 'desc'));
                return onSnapshot(q, (snapshot) => {
                    setOrders(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
            }, [user, isAdminLoggedIn, view]);

            const currentPipe = PRODUCT_DATA.pipes.find(p => p.size === selectedPipeSize);

            const addToCart = (product) => {
                setCart(prev => {
                    const exists = prev.find(item => item.id === product.id);
                    if (exists) return prev.map(item => item.id === product.id ? { ...item, qty: item.qty + 1 } : item);
                    return [...prev, { ...product, qty: 1 }];
                });
            };

            const handleCheckout = async () => {
                if (!customerName) { alert("Enter Name"); return; }
                setIsProcessing(true);
                const total = cart.reduce((sum, item) => sum + (item.rate * item.qty), 0);
                try {
                    const { getFirestore, collection, addDoc, serverTimestamp } = window.fb;
                    const db = getFirestore();
                    await addDoc(collection(db, 'artifacts', 'sri-vinayaga-laber-works-v1', 'public', 'data', 'orders'), { 
                        customerName, items: cart, total, createdAt: serverTimestamp(), userId: user.uid 
                    });
                    const msg = `*SRI VINAYAGA LABER WORKS*\n*CUSTOMER:* ${customerName}\n*TOTAL:* ₹${total}`;
                    window.open(`https://wa.me/918643861100?text=${encodeURIComponent(msg)}`);
                    setCart([]); setCustomerName(''); alert("Bill Sent!");
                } catch (e) { alert(e.message); } finally { setIsProcessing(false); }
            };

            return (
                <div className="min-h-screen pb-24">
                    <header className="bg-yellow-400 p-4 sticky top-0 z-50 shadow-sm text-center">
                        <h2 className="text-[10px] font-black uppercase tracking-widest opacity-70">{T.subtitle}</h2>
                        <h1 className="text-lg font-black">{T.title}</h1>
                    </header>

                    <main className="max-w-xl mx-auto p-4 space-y-6">
                        {view === 'shop' ? (
                            <>
                                <div className="bg-white p-6 rounded-3xl border shadow-sm space-y-4">
                                    <div className="flex items-center gap-2 mb-2">
                                        <Icon name="Package" className="text-yellow-600" />
                                        <h3 className="font-black uppercase text-sm">{T.pvcPipes}</h3>
                                    </div>
                                    <div className="grid grid-cols-1 gap-4">
                                        <div className="relative">
                                            <label className="text-[10px] font-bold text-slate-400 absolute left-3 top-2 uppercase">{T.pipeSize}</label>
                                            <select 
                                                className="w-full bg-slate-50 rounded-2xl pt-7 pb-3 px-3 font-bold appearance-none" 
                                                value={selectedPipeSize} 
                                                onChange={e => setSelectedPipeSize(parseInt(e.target.value))}
                                            >
                                                {PRODUCT_DATA.pipes.map(p => <option key={p.size} value={p.size}>{p.size}mm</option>)}
                                            </select>
                                            <Icon name="ChevronDown" size={16} className="absolute right-3 top-1/2 mt-1 text-slate-400" />
                                        </div>
                                        <button 
                                            onClick={() => addToCart({
                                                id: `p-${selectedPipeSize}`, 
                                                label: `${selectedPipeSize}mm Bend`, 
                                                rate: currentPipe.rates[Object.keys(currentPipe.rates)[0]]
                                            })} 
                                            className="bg-yellow-400 p-4 rounded-2xl font-black text-lg active:scale-95 transition-transform"
                                        >
                                            {T.add}
                                        </button>
                                    </div>
                                </div>

                                {cart.length > 0 && (
                                    <div className="bg-slate-900 text-white p-6 rounded-[2.5rem] shadow-xl space-y-4">
                                        <div className="flex justify-between items-center border-b border-white/10 pb-4">
                                            <h3 className="font-black uppercase tracking-widest text-xs opacity-50">Current Items</h3>
                                            <button onClick={() => setCart([])}><Icon name="X" size={18} /></button>
                                        </div>
                                        <div className="space-y-3">
                                            {cart.map(item => (
                                                <div key={item.id} className="flex justify-between items-center">
                                                    <span className="font-bold">{item.qty} x {item.label}</span>
                                                    <span className="font-black">₹{item.rate * item.qty}</span>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="pt-4 border-t border-white/10 flex justify-between items-end">
                                            <span className="text-[10px] font-bold opacity-50 uppercase">{T.grandTotal}</span>
                                            <span className="text-3xl font-black">₹{cart.reduce((s,i)=>s+(i.rate*i.qty),0)}</span>
                                        </div>
                                        <div className="space-y-3 pt-4">
                                            <input 
                                                className="w-full p-4 rounded-2xl bg-white/10 border border-white/20 text-white placeholder:text-white/30 font-bold outline-none" 
                                                placeholder={T.customerName} 
                                                value={customerName} 
                                                onChange={e=>setCustomerName(e.target.value)} 
                                            />
                                            <button 
                                                onClick={handleCheckout} 
                                                className="w-full bg-green-500 p-5 rounded-2xl font-black text-lg flex items-center justify-center gap-2"
                                            >
                                                <Icon name="Send" size={20} /> {T.generateBill}
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </>
                        ) : (
                            <div className="space-y-4">
                                {!isAdminLoggedIn ? (
                                    <div className="bg-white p-10 rounded-3xl border shadow-sm text-center space-y-6">
                                        <Icon name="Lock" size={48} className="mx-auto text-slate-300" />
                                        <input 
                                            type="password" 
                                            className="w-full p-4 rounded-xl bg-slate-50 border font-bold text-center" 
                                            placeholder="Owner Password" 
                                            value={loginPassword} 
                                            onChange={e => setLoginPassword(e.target.value)} 
                                        />
                                        <button 
                                            onClick={() => loginPassword === "Owner@123" ? setIsAdminLoggedIn(true) : alert("Wrong")} 
                                            className="w-full bg-slate-900 text-white p-4 rounded-xl font-black"
                                        >
                                            Login
                                        </button>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <div className="flex justify-between items-center">
                                            <h3 className="font-black flex items-center gap-2"><Icon name="History" /> Sales</h3>
                                            <button onClick={() => setIsAdminLoggedIn(false)} className="text-red-500 font-bold text-xs uppercase">Logout</button>
                                        </div>
                                        {orders.map(o => (
                                            <div key={o.id} className="bg-white p-5 rounded-2xl border shadow-sm">
                                                <div className="flex justify-between items-start mb-2">
                                                    <span className="font-black uppercase text-sm">{o.customerName}</span>
                                                    <span className="font-black text-green-600">₹{o.total}</span>
                                                </div>
                                                <div className="text-[10px] text-slate-400 font-bold">{o.createdAt?.toDate().toLocaleString()}</div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t h-20 flex justify-around items-center px-6 shadow-2xl z-50">
                        <button onClick={() => setView('shop')} className={`flex flex-col items-center gap-1 ${view === 'shop' ? 'text-yellow-600' : 'text-slate-300'}`}>
                            <Icon name="Package" size={24} />
                            <span className="text-[10px] font-black uppercase">{T.shop}</span>
                        </button>
                        <button onClick={() => setView('admin')} className={`flex flex-col items-center gap-1 ${view === 'admin' ? 'text-yellow-600' : 'text-slate-300'}`}>
                            <Icon name="ClipboardList" size={24} />
                            <span className="text-[10px] font-black uppercase">{T.owner}</span>
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
