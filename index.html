<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sri Vinayaga Laber Works</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        select { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); 
            background-repeat: no-repeat; 
            background-position: right 0.75rem center; 
            background-size: 1rem; 
            -webkit-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const PRODUCT_DATA = {
            pipes: [
                { size: 20, rates: { "15 Kgs": 1.40 } },
                { size: 25, rates: { "10 Kgs": 1.50, "15 Kgs": 2.00 } },
                { size: 32, rates: { "10 Kgs": 2.50, "15 Kgs": 2.80 } },
                { size: 40, rates: { "6 Kgs": 3.00, "10 Kgs": 4.00, "15 Kgs": 3.70 } },
                { size: 50, rates: { "6 Kgs": 4.00, "10 Kgs": 6.00, "15 Kgs": 4.95, "S-Bend": 8.00 } },
                { size: 63, rates: { "4 Kgs": 6.50, "6 Kgs": 7.00, "S-Bend": 9.00 } },
                { size: 75, rates: { "4 Kgs": 7.50, "6 Kgs": 8.60, "S-Bend": 10.00 } },
                { size: 90, rates: { "4 Kgs": 9.50, "6 Kgs": 11.50, "S-Bend": 13.00 } },
                { size: 110, rates: { "4 Kgs": 13.50, "6 Kgs": 15.00, "S-Bend": 17.00 } },
                { size: 140, rates: { "4 Kgs": 65.00, "6 Kgs": 80.00, "S-Bend": 115.00 } },
                { size: 160, rates: { "4 Kgs": 100.00, "6 Kgs": 115.00, "S-Bend": 172.50 } },
                { size: 180, rates: { "4 Kgs": 170.00, "6 Kgs": 195.50 } },
                { size: 200, rates: { "4 Kgs": 220.00, "6 Kgs": 245.50 } },
            ],
            coupler: [
                { size: 20, rates: { "15 Kgs": 1.00 } },
                { size: 25, rates: { "10 Kgs": 1.15, "15 Kgs": 1.30 } },
                { size: 32, rates: { "10 Kgs": 1.40, "15 Kgs": 1.50 } },
                { size: 40, rates: { "6 Kgs": 2.00, "10 Kgs": 2.30, "15 Kgs": 2.35 } },
                { size: 50, rates: { "6 Kgs": 2.30, "10 Kgs": 2.50 } },
                { size: 63, rates: { "4 Kgs": 3.00, "6 Kgs": 3.45 } },
                { size: 75, rates: { "4 Kgs": 3.45, "6 Kgs": 4.00 } },
                { size: 90, rates: { "4 Kgs": 4.50, "6 Kgs": 5.20 } },
                { size: 110, rates: { "4 Kgs": 5.20, "6 Kgs": 6.30 } },
                { size: 140, rates: { "4 Kgs": 8.60, "6 Kgs": 9.00 } },
                { size: 160, rates: { "4 Kgs": 11.50, "6 Kgs": 12.65 } },
            ],
            jetFootvale: [
                { name: "50*6", rate: 30.00 }, { name: "50*15", rate: 35.00 },
                { name: "50*32", rate: 45.00 }, { name: "50*40", rate: 55.00 },
                { name: "63*6", rate: 45.00 }, { name: "63*15", rate: 55.00 },
            ],
        };

        const TRANSLATIONS = {
            en: {
                title: "SRI VINAYAGA LABER WORKS",
                subtitle: "SRI PACHAIAMMAN THUNAI",
                address: "SINTHAN NAGAR, KRISHNAMPALAYAM, ERODE - 03",
                contacts: "CELL: 9095786363, 8015767107",
                bend: "BEND", coupler: "COUPLER", jet: "JET FOOTVALE",
                add: "Add to Bill", total: "Total Amount", whatsapp: "Send to WhatsApp",
                pdf: "Download PDF", name: "Customer Name",
                viewBill: "Generate Bill", empty: "Cart Empty",
                size: "Size (mm)", type: "Type"
            },
            ta: {
                title: "ஸ்ரீ விநாயகா லேபர் ஒர்க்ஸ்",
                subtitle: "ஸ்ரீ பச்சையம்மன் துணை",
                address: "சிந்தன் நகர், கிருஷ்ணம்பாளையம், ஈரோடு - 03",
                contacts: "செல்: 9095786363, 8015767107",
                bend: "பெண்ட் (BEND)", coupler: "கப்ளர் (COUPLER)", jet: "ஜெட் (JET)",
                add: "சேர்க்க", total: "மொத்த தொகை", whatsapp: "வாட்ஸ்அப் அனுப்ப",
                pdf: "பில் பதிவிறக்கம்", name: "வாடிக்கையாளர் பெயர்",
                viewBill: "பில் உருவாக்கு", empty: "பட்டியல் காலியாக உள்ளது",
                size: "அளவு", type: "வகை"
            }
        };

        const Icon = ({ name, className }) => {
            const icons = {
                whatsapp: <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 1 1-7.6-11.7 8.38 8.38 0 0 1 3.8.9L21 3zM17 15.5c-.2-.4-.8-.6-1.6-.9-.8-.4-1.1-.6-1.3-.8-.2-.2-.3-.5-.1-.8s.6-.8.8-1c.2-.2.3-.5.1-.8-.2-.3-.8-1.9-1.1-2.5-.3-.6-.6-.5-.8-.5H13c-.2 0-.6.1-.9.5-.3.4-1.1 1.1-1.1 2.6s1.1 3 1.2 3.2c.1.2 2.2 3.4 5.4 4.7.7.3 1.3.5 1.8.7.8.2 1.5.2 2 .1.6-.1 1.7-.7 2-1.4.3-.7.3-1.3.2-1.4-.1-.1-.3-.2-.5-.3z" />,
                plus: <path d="M12 5v14M5 12h14" />,
                close: <path d="M18 6 6 18M6 6l12 12" />,
                file: <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />,
                trash: <path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />,
                check: <path d="M20 6 9 17l-5-5" />
            };
            return (
                <svg className={className} width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                    {icons[name]}
                </svg>
            );
        };

        function App() {
            const [lang, setLang] = useState('ta');
            const [cart, setCart] = useState([]);
            const [customerName, setCustomerName] = useState('');
            const [showModal, setShowModal] = useState(false);
            const [isBillGenerated, setIsBillGenerated] = useState(false);
            const [billNo, setBillNo] = useState(1001);
            
            const [pS, setPS] = useState(20); 
            const [pW, setPW] = useState("15 Kgs");
            const [cS, setCS] = useState(20); 
            const [cW, setCW] = useState("15 Kgs");
            const [jN, setJN] = useState(PRODUCT_DATA.jetFootvale[0].name);

            const T = TRANSLATIONS[lang];

            useEffect(() => {
                const pipe = PRODUCT_DATA.pipes.find(p => p.size === pS);
                if (pipe) {
                    const availableRates = Object.keys(pipe.rates);
                    if (!pipe.rates[pW]) setPW(availableRates[0]);
                }
            }, [pS]);

            useEffect(() => {
                const coupler = PRODUCT_DATA.coupler.find(p => p.size === cS);
                if (coupler) {
                    const availableRates = Object.keys(coupler.rates);
                    if (!coupler.rates[cW]) setCW(availableRates[0]);
                }
            }, [cS]);

            const addToCart = (id, labelEn, labelTa, rate) => {
                if (rate === undefined || rate === null) return;
                setCart(prev => {
                    const exists = prev.find(i => i.id === id);
                    if (exists) return prev.map(i => i.id === id ? {...i, qty: i.qty + 1} : i);
                    return [...prev, { id, labelEn, labelTa, rate, qty: 1 }];
                });
            };

            const removeFromCart = (id) => setCart(prev => prev.filter(i => i.id !== id));

            const grandTotal = cart.reduce((a, b) => a + (b.rate * b.qty), 0);

            const handleGenerateBillAction = () => {
                if (!customerName.trim()) {
                    alert(lang === 'ta' ? "வாடிக்கையாளர் பெயரை உள்ளிடவும்" : "Please enter customer name");
                    return;
                }
                setIsBillGenerated(true);
            };

            const sendWhatsApp = () => {
                if (!isBillGenerated) return;
                const date = new Date().toLocaleDateString();
                const msg = `*${T.title}*\n_${T.address}_\n--------------------------\n*Bill No:* #${billNo}\n*Date:* ${date}\n*Customer:* ${customerName.trim()}\n--------------------------\n${cart.map(i => `• ${lang==='en'?i.labelEn:i.labelTa}\n  ${i.qty} x ₹${i.rate.toFixed(2)} = *₹${(i.rate*i.qty).toFixed(2)}*`).join('\n\n')}\n--------------------------\n*TOTAL: ₹${grandTotal.toFixed(2)}*\n--------------------------`;
                
                const whatsappUrl = `https://wa.me/918643861100?text=${encodeURIComponent(msg)}`;
                window.open(whatsappUrl, '_blank');
                
                setBillNo(prev => prev + 1);
                setCart([]); setCustomerName(''); setShowModal(false); setIsBillGenerated(false);
            };

            const downloadPDF = () => {
                if (!isBillGenerated) return;
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(10);
                doc.text(T.subtitle, 105, 12, { align: 'center' });
                doc.setFontSize(22);
                doc.setFont("helvetica", "bold");
                doc.text(T.title, 105, 22, { align: 'center' });
                doc.setFontSize(9);
                doc.setFont("helvetica", "normal");
                doc.text(T.address, 105, 28, { align: 'center' });
                doc.text(T.contacts, 105, 33, { align: 'center' });
                doc.setLineWidth(0.5);
                doc.line(20, 36, 190, 36);

                doc.setFontSize(11);
                doc.text(`Bill No: #${billNo}`, 20, 45);
                doc.text(`Date: ${new Date().toLocaleDateString()}`, 190, 45, { align: 'right' });
                doc.setFontSize(13);
                doc.setFont("helvetica", "bold");
                doc.text(`Customer: ${customerName.trim()}`, 20, 55);
                
                doc.autoTable({
                    startY: 62,
                    head: [['Description', 'Qty', 'Rate', 'Total']],
                    body: cart.map(i => [lang==='en'?i.labelEn:i.labelTa, i.qty, i.rate.toFixed(2), (i.rate*i.qty).toFixed(2)]),
                    foot: [['', '', 'GRAND TOTAL', `Rs. ${grandTotal.toFixed(2)}`]],
                    theme: 'grid',
                    headStyles: { fillColor: [250, 204, 21], textColor: [0, 0, 0], fontStyle: 'bold' }
                });
                
                doc.save(`Bill_${billNo}.pdf`);
            };

            const foundPipe = PRODUCT_DATA.pipes.find(p => p.size === pS);
            const currentPipeRate = foundPipe ? foundPipe.rates[pW] : 0;
            
            const foundCoupler = PRODUCT_DATA.coupler.find(p => p.size === cS);
            const currentCouplerRate = foundCoupler ? foundCoupler.rates[cW] : 0;
            
            const foundJet = PRODUCT_DATA.jetFootvale.find(j => j.name === jN);
            const currentJetRate = foundJet ? foundJet.rate : 0;

            return (
                <div className="min-h-screen bg-slate-50 pb-32">
                    {/* Top Info Area */}
                    <header className="bg-yellow-400 p-6 text-center shadow-md sticky top-0 z-30">
                        <button onClick={() => setLang(l => l === 'en' ? 'ta' : 'en')} className="absolute right-4 top-4 bg-white/40 p-2 px-3 rounded-full text-[10px] font-black uppercase">
                            {lang === 'en' ? 'Tamil' : 'English'}
                        </button>
                        <p className="text-[10px] font-black opacity-70 mb-1 tracking-widest">{T.subtitle}</p>
                        <h1 className="text-xl font-black mb-1 leading-tight">{T.title}</h1>
                        <p className="text-[9px] font-bold leading-tight opacity-80 max-w-[250px] mx-auto uppercase">{T.address}</p>
                        <p className="text-[10px] font-black mt-2 bg-black/10 inline-block px-4 py-1 rounded-full">{T.contacts}</p>
                    </header>

                    <div className="p-5 space-y-5 max-w-md mx-auto">
                        {/* Section: Bend */}
                        <div className="bg-white p-5 rounded-[2rem] border-2 border-slate-100 shadow-sm">
                            <h2 className="text-[10px] font-black text-slate-400 mb-4 uppercase tracking-widest">{T.bend}</h2>
                            <div className="grid grid-cols-2 gap-3 mb-4">
                                <select className="bg-slate-50 p-4 rounded-2xl font-black border-2 border-slate-100 text-sm" value={pS} onChange={e => setPS(Number(e.target.value))}>
                                    {PRODUCT_DATA.pipes.map(p => <option key={p.size} value={p.size}>{p.size}mm</option>)}
                                </select>
                                <select className="bg-slate-50 p-4 rounded-2xl font-black border-2 border-slate-100 text-sm" value={pW} onChange={e => setPW(e.target.value)}>
                                    {foundPipe && Object.keys(foundPipe.rates).map(r => <option key={r} value={r}>{r}</option>)}
                                </select>
                            </div>
                            <button onClick={() => addToCart(`b-${pS}-${pW}`, `${pS}mm Bend ${pW}`, `${pS}மிமீ பெண்ட் ${pW}`, currentPipeRate)} 
                                className="w-full bg-yellow-400 hover:bg-yellow-500 p-4 rounded-2xl font-black text-sm flex items-center justify-center gap-3 active:scale-95 transition-transform">
                                <span className="bg-black/10 px-3 py-1 rounded-lg flex items-center gap-1">
                                    <Icon name="plus" className="w-4 h-4" />
                                    ₹{(currentPipeRate || 0).toFixed(2)}
                                </span>
                                {T.add}
                            </button>
                        </div>

                        {/* Section: Coupler */}
                        <div className="bg-white p-5 rounded-[2rem] border-2 border-slate-100 shadow-sm">
                            <h2 className="text-[10px] font-black text-slate-400 mb-4 uppercase tracking-widest">{T.coupler}</h2>
                            <div className="grid grid-cols-2 gap-3 mb-4">
                                <select className="bg-slate-50 p-4 rounded-2xl font-black border-2 border-slate-100 text-sm" value={cS} onChange={e => setCS(Number(e.target.value))}>
                                    {PRODUCT_DATA.coupler.map(p => <option key={p.size} value={p.size}>{p.size}mm</option>)}
                                </select>
                                <select className="bg-slate-50 p-4 rounded-2xl font-black border-2 border-slate-100 text-sm" value={cW} onChange={e => setCW(e.target.value)}>
                                    {foundCoupler && Object.keys(foundCoupler.rates).map(r => <option key={r} value={r}>{r}</option>)}
                                </select>
                            </div>
                            <button onClick={() => addToCart(`c-${cS}-${cW}`, `${cS}mm Coupler ${cW}`, `${cS}மிமீ கப்ளர் ${cW}`, currentCouplerRate)} 
                                className="w-full bg-blue-600 text-white p-4 rounded-2xl font-black text-sm flex items-center justify-center gap-3 active:scale-95 transition-transform">
                                <span className="bg-white/20 px-3 py-1 rounded-lg flex items-center gap-1">
                                    <Icon name="plus" className="w-4 h-4" />
                                    ₹{(currentCouplerRate || 0).toFixed(2)}
                                </span>
                                {T.add}
                            </button>
                        </div>

                        {/* Section: Jet */}
                        <div className="bg-white p-5 rounded-[2rem] border-2 border-slate-100 shadow-sm">
                            <h2 className="text-[10px] font-black text-slate-400 mb-4 uppercase tracking-widest">{T.jet}</h2>
                            <select className="w-full bg-slate-50 p-4 rounded-2xl font-black border-2 border-slate-100 mb-4 text-sm" value={jN} onChange={e => setJN(e.target.value)}>
                                {PRODUCT_DATA.jetFootvale.map(j => <option key={j.name} value={j.name}>{j.name}</option>)}
                            </select>
                            <button onClick={() => addToCart(`j-${jN}`, `Jet ${jN}`, `ஜெட் ${jN}`, currentJetRate)} 
                                className="w-full bg-slate-900 text-white p-4 rounded-2xl font-black text-sm flex items-center justify-center gap-3 active:scale-95 transition-transform">
                                <span className="bg-white/10 px-3 py-1 rounded-lg flex items-center gap-1">
                                    <Icon name="plus" className="w-4 h-4" />
                                    ₹{(currentJetRate || 0).toFixed(2)}
                                </span>
                                {T.add}
                            </button>
                        </div>
                    </div>

                    {/* Footer Generation Button */}
                    {cart.length > 0 && (
                        <div className="fixed bottom-6 left-6 right-6 z-40">
                            <button onClick={() => { setShowModal(true); setIsBillGenerated(false); }} className="w-full bg-slate-900 text-white p-5 rounded-full shadow-2xl flex justify-between items-center px-8 border-2 border-yellow-400">
                                <div className="text-left">
                                    <p className="text-[10px] font-black text-yellow-400 uppercase leading-none mb-1">{T.total}</p>
                                    <p className="font-black text-xl">₹{grandTotal.toFixed(2)}</p>
                                </div>
                                <span className="uppercase text-[10px] font-black tracking-widest bg-yellow-400 text-slate-900 px-5 py-2 rounded-full">{T.viewBill}</span>
                            </button>
                        </div>
                    )}

                    {/* Final Processing Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-slate-900/90 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm rounded-[3rem] p-8 space-y-6 overflow-y-auto max-h-[90vh]">
                                <div className="flex justify-between items-start">
                                    <h3 className="font-black text-2xl">Bill Preview</h3>
                                    <button onClick={() => setShowModal(false)} className="bg-slate-100 p-2 rounded-full"><Icon name="close" /></button>
                                </div>

                                <div className="space-y-4">
                                    <div className="max-h-[30vh] overflow-y-auto space-y-2 no-scrollbar pr-2">
                                        {cart.map(i => (
                                            <div key={i.id} className="flex justify-between items-center p-3 bg-slate-50 rounded-xl">
                                                <div className="text-[11px] font-bold">
                                                    <p>{lang==='en'?i.labelEn:i.labelTa}</p>
                                                    <p className="opacity-50">{i.qty} x ₹{i.rate.toFixed(2)}</p>
                                                </div>
                                                <button onClick={() => removeFromCart(i.id)} className="text-red-400"><Icon name="trash" /></button>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="pt-2">
                                        <label className="text-[10px] font-black uppercase text-slate-400 block mb-1">{T.name}</label>
                                        <input 
                                            className="w-full bg-slate-100 p-4 rounded-xl font-black border-2 border-transparent focus:border-yellow-400 outline-none" 
                                            placeholder="Enter Customer Name..." 
                                            value={customerName} 
                                            onChange={e => setCustomerName(e.target.value)}
                                            disabled={isBillGenerated}
                                        />
                                    </div>
                                </div>

                                {!isBillGenerated ? (
                                    <button 
                                        onClick={handleGenerateBillAction}
                                        className="w-full bg-slate-900 text-white p-5 rounded-2xl font-black flex items-center justify-center gap-2"
                                    >
                                        <Icon name="check" /> Generate Bill
                                    </button>
                                ) : (
                                    <div className="space-y-3 pt-2">
                                        <div className="text-center pb-4">
                                            <p className="text-xs font-bold text-green-500">✓ Bill Generated Successfully!</p>
                                            <p className="text-2xl font-black">₹{grandTotal.toFixed(2)}</p>
                                        </div>
                                        <button onClick={sendWhatsApp} className="w-full bg-green-500 text-white p-5 rounded-2xl font-black flex items-center justify-center gap-2 shadow-lg shadow-green-100">
                                            <Icon name="whatsapp" /> {T.whatsapp}
                                        </button>
                                        <button onClick={downloadPDF} className="w-full bg-slate-900 text-white p-5 rounded-2xl font-black text-sm flex items-center justify-center gap-2">
                                            <Icon name="file" /> {T.pdf}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
