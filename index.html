<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#fbbf24">
<meta name="description" content="Sri Vinayaga Laber Works - Billing System">
<title>Sri Vinayaga Laber Works</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<style>
* {
    -webkit-tap-highlight-color: transparent;
}

body { 
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
    background: #f8fafc; 
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

select, input { 
    width: 100%; 
    padding: 14px 16px; 
    border-radius: 12px; 
    margin-bottom: 8px; 
    border: 1px solid #d1d5db; 
    font-size: 16px;
    background: white;
}

input:focus, select:focus {
    outline: none;
    border-color: #f59e0b;
    box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
}

button { 
    border-radius: 12px; 
    font-size: 16px;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
    user-select: none;
}

button:active {
    transform: scale(0.98);
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.hidden-login { 
    position: absolute; 
    top: 16px; 
    right: 16px; 
    opacity: 0.1; 
    cursor: pointer; 
    font-size: 14px; 
    z-index: 100;
    background: white;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.product-card { 
    transition: all 0.3s ease; 
}

.quantity-btn { 
    width: 44px; 
    height: 44px; 
    border-radius: 50%; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-weight: bold;
    font-size: 20px;
}

.cart-item { 
    animation: slideIn 0.3s ease; 
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}

.tamil-text { 
    font-family: 'Arial Unicode MS', 'TAMu_Kadambri', 'Latha', 'Noto Sans Tamil', sans-serif; 
}

.dual-text { 
    display: flex; 
    flex-direction: column;
    line-height: 1.4;
}

.english-text { 
    font-weight: 600; 
    font-size: 1em;
}

.tamil-text-part { 
    font-size: 0.85em; 
    color: #4b5563; 
    margin-top: 2px;
    font-weight: 400;
}

/* Notification Styles */
.notification {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #10b981;
    color: white;
    padding: 12px 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideDown 0.3s ease, fadeOut 0.3s ease 2s forwards;
    max-width: 90%;
    text-align: center;
}

.notification.error {
    background: #ef4444;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translate(-50%, -20px);
    }
    to {
        opacity: 1;
        transform: translate(-50%, 0);
    }
}

@keyframes fadeOut {
    to {
        opacity: 0;
        visibility: hidden;
    }
}

/* Responsive adjustments */
@media (max-width: 640px) {
    .container-padding {
        padding: 16px;
    }
    
    .quantity-btn {
        width: 40px;
        height: 40px;
        font-size: 18px;
    }
    
    select, input {
        padding: 12px 14px;
        font-size: 16px;
    }
    
    button {
        padding: 14px;
        font-size: 16px;
    }
    
    .notification {
        top: 10px;
        padding: 10px 16px;
        font-size: 14px;
    }
}

@media (min-width: 641px) {
    .container-padding {
        padding: 24px;
        max-width: 480px;
        margin: 0 auto;
    }
    
    .quantity-btn {
        width: 44px;
        height: 44px;
        font-size: 20px;
    }
}

@media (min-width: 1024px) {
    .container-padding {
        max-width: 480px;
        padding: 32px 24px;
    }
}

/* Scrollbar styling */
::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: #a1a1a1;
}

/* Modal animations */
.modal-enter {
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Touch-friendly sizes */
.touch-target {
    min-height: 44px;
    min-width: 44px;
}

/* Hide scrollbar for Chrome, Safari and Opera */
.no-scrollbar::-webkit-scrollbar {
    display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.no-scrollbar {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
}

/* Product grid for desktop */
@media (min-width: 768px) {
    .product-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .product-card {
        margin-bottom: 0;
    }
}
</style>

<!-- PWA Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js').then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, function(err) {
            console.log('ServiceWorker registration failed: ', err);
        });
    });
}

// Prevent context menu on long press
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});

// Prevent text selection on mobile
document.addEventListener('selectstart', function(e) {
    e.preventDefault();
});

// Add to home screen prompt
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    console.log('PWA installation available');
});
</script>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useMemo, useEffect } = React;

/* üîê OWNER */
const OWNER_PASSWORD = "6363";
const WHATSAPP_NO = "918643861100";

/* üì¶ PRODUCTS */
const PRODUCTS = {
    bend: [
        { size: 20, rates: { "15 Kgs": 1.40 } },
        { size: 25, rates: { "10 Kgs": 1.50, "15 Kgs": 2.00 } },
        { size: 32, rates: { "10 Kgs": 2.50, "15 Kgs": 2.80 } },
        { size: 40, rates: { "6 Kgs": 3.00, "10 Kgs": 4.00, "15 Kgs": 3.70 } },
        { size: 50, rates: { "6 Kgs": 4.00, "10 Kgs": 6.00, "15 Kgs": 4.95, "S-Bend": 8.00 } },
        { size: 63, rates: { "4 Kgs": 6.50, "6 Kgs": 7.00, "S-Bend": 9.00 } },
        { size: 75, rates: { "4 Kgs": 7.50, "6 Kgs": 8.60, "S-Bend": 10.00 } },
        { size: 90, rates: { "4 Kgs": 9.50, "6 Kgs": 11.50, "S-Bend": 13.00 } },
        { size: 110, rates: { "4 Kgs": 13.50, "6 Kgs": 15.00, "S-Bend": 17.00 } },
        { size: 140, rates: { "4 Kgs": 65.00, "6 Kgs": 80.00, "S-Bend": 115.00 } },
        { size: 160, rates: { "4 Kgs": 100.00, "6 Kgs": 115.00, "S-Bend": 172.50 } },
        { size: 180, rates: { "4 Kgs": 170.00, "6 Kgs": 195.50 } },
        { size: 200, rates: { "4 Kgs": 220.00, "6 Kgs": 245.50 } }
    ],
    coupler: [
        { size: 20, rates: { "15 Kgs": 1.00 } },
        { size: 25, rates: { "10 Kgs": 1.15, "15 Kgs": 1.30 } },
        { size: 32, rates: { "10 Kgs": 1.40, "15 Kgs": 1.50 } },
        { size: 40, rates: { "6 Kgs": 2.00, "10 Kgs": 2.30, "15 Kgs": 2.35 } },
        { size: 50, rates: { "6 Kgs": 2.30, "10 Kgs": 2.50 } },
        { size: 63, rates: { "4 Kgs": 3.00, "6 Kgs": 3.45 } },
        { size: 75, rates: { "4 Kgs": 3.45, "6 Kgs": 4.00 } },
        { size: 90, rates: { "4 Kgs": 4.50, "6 Kgs": 5.20 } },
        { size: 110, rates: { "4 Kgs": 5.20, "6 Kgs": 6.30 } },
        { size: 140, rates: { "4 Kgs": 8.60, "6 Kgs": 9.00 } },
        { size: 160, rates: { "4 Kgs": 11.50, "6 Kgs": 12.65 } }
    ],
    jet: [
        { name: "50*6", rate: 30 },
        { name: "50*15", rate: 35 },
        { name: "50*32", rate: 45 },
        { name: "50*40", rate: 55 },
        { name: "63*6", rate: 45 },
        { name: "63*15", rate: 55 }
    ]
};

/* üåê TRANSLATIONS */
const TRANSLATIONS = {
    en: {
        title: "SRI VINAYAGA LABER WORKS",
        address: "Sinthan Nagar, Krishnampalayam, Erode - 03",
        phone: "Cell: 9095786363, 8015767107",
        customerName: "Customer Name",
        customerPlaceholder: "Enter customer name",
        bend: "BEND",
        coupler: "COUPLER",
        jetValve: "JET VALVE",
        addToCart: "Add Selected to Cart",
        cart: "Cart",
        items: "items",
        total: "Total",
        generateBill: "Generate Bill",
        enterCustomerName: "Enter Customer Name",
        addItems: "Add Items to Cart",
        ownerLogin: "Owner Login",
        orderHistory: "Order History",
        logout: "Logout",
        noBills: "No bills yet",
        billGenerated: "Bill Generated!",
        sendWhatsAppPDF: "Send WhatsApp & Download PDF",
        sendWhatsApp: "Send via WhatsApp",
        downloadPDF: "Download PDF",
        doneNewBill: "Done & New Bill",
        thankYou: "Thank you for your business!",
        quantity: "Qty",
        rate: "Rate",
        amount: "Amount",
        subtotal: "Subtotal:",
        each: "each"
    },
    ta: {
        title: "‡Æ∏‡Øç‡Æ∞‡ØÄ ‡Æµ‡Æø‡Æ®‡Ææ‡ÆØ‡Æï ‡Æ≤‡Øá‡Æ™‡Æ∞‡Øç ‡Æµ‡Øä‡Æ∞‡Øç‡Æï‡Øç‡Æ∏‡Øç",
        address: "‡Æö‡Æø‡Æ®‡Øç‡Æ§‡Æ©‡Øç ‡Æ®‡Æï‡Æ∞‡Øç, ‡Æï‡Æø‡Æ∞‡ØÅ‡Æ∑‡Øç‡Æ£‡ÆÆ‡Øç‡Æ™‡Ææ‡Æ≥‡Øà‡ÆØ‡ÆÆ‡Øç, ‡Æà‡Æ∞‡Øã‡Æü‡ØÅ - 03",
        phone: "‡Æ§‡Øä‡Æ≤‡Øà‡Æ™‡Øá‡Æö‡Æø: 9095786363, 8015767107",
        customerName: "‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç",
        customerPlaceholder: "‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç",
        bend: "‡Æ™‡ØÜ‡Æ£‡Øç‡Æü‡Øç",
        coupler: "‡Æï‡Æ™‡Øç‡Æ≤‡Æ∞‡Øç",
        jetValve: "‡Æú‡ØÜ‡Æü‡Øç ‡Æµ‡Ææ‡Æ≤‡Øç‡Æµ‡Øç",
        addToCart: "‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡Æ±‡Øç‡Æ±‡Øà ‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øç‡Æü‡Æø‡Æ≤‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
        cart: "‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øç",
        items: "‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øç",
        total: "‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç",
        generateBill: "‡Æ™‡Æø‡Æ≤‡Øç ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ",
        enterCustomerName: "‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç",
        addItems: "‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øç‡Æü‡Æø‡Æ≤‡Øç ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
        ownerLogin: "‡Æâ‡Æ∞‡Æø‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ",
        orderHistory: "‡ÆÜ‡Æ∞‡Øç‡Æü‡Æ∞‡Øç ‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ",
        logout: "‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡ØÅ",
        noBills: "‡Æá‡Æ©‡Øç‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æø‡Æ≤‡Øç‡Æ≤‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà",
        billGenerated: "‡Æ™‡Æø‡Æ≤‡Øç ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ!",
        sendWhatsAppPDF: "WhatsApp ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ & PDF ‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡ØÅ",
        sendWhatsApp: "WhatsApp ‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ",
        downloadPDF: "PDF ‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡ØÅ",
        doneNewBill: "‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ & ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æ™‡Æø‡Æ≤‡Øç",
        thankYou: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Æ£‡Æø‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æ®‡Æ©‡Øç‡Æ±‡Æø!",
        quantity: "‡ÆÖ‡Æ≥‡Æµ‡ØÅ",
        rate: "‡Æµ‡Æø‡Æ≤‡Øà",
        amount: "‡Æ§‡Øä‡Æï‡Øà",
        subtotal: "‡Æ§‡ØÅ‡Æ£‡Øà‡Æ§‡Øç‡Æ§‡Øä‡Æï‡Øà:",
        each: "‡Æí‡Æµ‡Øç‡Æµ‡Øä‡Æ©‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç"
    }
};

// Function to render dual language text
const DualText = ({ en, ta }) => (
    <div className="dual-text">
        <span className="english-text">{en}</span>
        <span className="tamil-text tamil-text-part">{ta}</span>
    </div>
);

// Notification Component
const Notification = ({ message, type = 'success', onClose }) => {
    useEffect(() => {
        const timer = setTimeout(() => {
            onClose();
        }, 2000); // Auto close after 2 seconds

        return () => clearTimeout(timer);
    }, [onClose]);

    return (
        <div className={`notification ${type}`}>
            <span>‚úÖ</span>
            <span>{message}</span>
        </div>
    );
};

function App() {
    const [cart, setCart] = useState([]);
    const [customer, setCustomer] = useState("");
    const [history, setHistory] = useState([]);
    const [billNo, setBillNo] = useState(() => {
        const saved = localStorage.getItem('billNo');
        return saved ? parseInt(saved) : 1001;
    });
    const [ownerMode, setOwnerMode] = useState(false);
    const [password, setPassword] = useState("");
    const [showLogin, setShowLogin] = useState(false);
    const [showBillOptions, setShowBillOptions] = useState(false);
    const [currentBill, setCurrentBill] = useState(null);
    const [activeCategory, setActiveCategory] = useState("bend");
    const [productQuantities, setProductQuantities] = useState({});
    const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
    const [notification, setNotification] = useState(null);

    const t = TRANSLATIONS.en;

    useEffect(() => {
        localStorage.setItem('billNo', billNo);
        
        const checkMobile = () => setIsMobile(window.innerWidth < 768);
        window.addEventListener('resize', checkMobile);
        return () => window.removeEventListener('resize', checkMobile);
    }, [billNo]);

    // Show notification
    const showNotification = (message, type = 'success') => {
        setNotification({ message, type });
        setTimeout(() => {
            setNotification(null);
        }, 2000);
    };

    // Initialize quantities for all products
    useEffect(() => {
        const quantities = {};
        
        PRODUCTS.bend.forEach(b => {
            Object.keys(b.rates).forEach(weight => {
                const key = `bend_${b.size}_${weight}`;
                quantities[key] = 0;
            });
        });
        
        PRODUCTS.coupler.forEach(c => {
            Object.keys(c.rates).forEach(weight => {
                const key = `coupler_${c.size}_${weight}`;
                quantities[key] = 0;
            });
        });
        
        PRODUCTS.jet.forEach(j => {
            const key = `jet_${j.name}`;
            quantities[key] = 0;
        });
        
        setProductQuantities(quantities);
    }, []);

    const updateQuantity = (productKey, change) => {
        setProductQuantities(prev => {
            const current = prev[productKey] || 0;
            const newQuantity = Math.max(0, current + change);
            return { ...prev, [productKey]: newQuantity };
        });
    };

    const addToCartFromQuantities = () => {
        const newItems = [];
        
        PRODUCTS.bend.forEach(b => {
            Object.entries(b.rates).forEach(([weight, rate]) => {
                const key = `bend_${b.size}_${weight}`;
                const quantity = productQuantities[key] || 0;
                
                if (quantity > 0) {
                    newItems.push({ 
                        name: `${b.size}mm Bend ${weight}`, 
                        rate: rate,
                        quantity: quantity,
                        subtotal: rate * quantity,
                        category: 'bend',
                        productKey: key
                    });
                }
            });
        });
        
        PRODUCTS.coupler.forEach(c => {
            Object.entries(c.rates).forEach(([weight, rate]) => {
                const key = `coupler_${c.size}_${weight}`;
                const quantity = productQuantities[key] || 0;
                
                if (quantity > 0) {
                    newItems.push({ 
                        name: `${c.size}mm Coupler ${weight}`, 
                        rate: rate,
                        quantity: quantity,
                        subtotal: rate * quantity,
                        category: 'coupler',
                        productKey: key
                    });
                }
            });
        });
        
        PRODUCTS.jet.forEach(j => {
            const key = `jet_${j.name}`;
            const quantity = productQuantities[key] || 0;
            
            if (quantity > 0) {
                newItems.push({ 
                    name: `Jet ${j.name}`, 
                    rate: j.rate,
                    quantity: quantity,
                    subtotal: j.rate * quantity,
                    category: 'jet',
                    productKey: key
                });
            }
        });

        if (newItems.length > 0) {
            setCart(prev => [...prev, ...newItems]);
            
            const resetQuantities = { ...productQuantities };
            newItems.forEach(item => {
                resetQuantities[item.productKey] = 0;
            });
            setProductQuantities(resetQuantities);
            
            // Show notification instead of alert
            showNotification(`${newItems.length} items added to cart!`, 'success');
        } else {
            // Show error notification instead of alert
            showNotification("Please select quantities before adding to cart!", 'error');
        }
    };

    const clearAllQuantities = () => {
        const resetQuantities = { ...productQuantities };
        Object.keys(resetQuantities).forEach(key => {
            resetQuantities[key] = 0;
        });
        setProductQuantities(resetQuantities);
    };

    const total = useMemo(() => 
        cart.reduce((s, i) => s + (i.subtotal || i.rate), 0), [cart]);

    const generateBill = () => {
        if (!customer || cart.length === 0) {
            showNotification("Please enter customer name and add items to cart!", 'error');
            return;
        }

        const bill = {
            billNo,
            customer,
            items: cart.map(item => ({
                ...item,
                subtotal: item.subtotal || item.rate
            })),
            total,
            date: new Date().toLocaleString()
        };

        setHistory(h => [bill, ...h]);
        setCurrentBill(bill);
        setShowBillOptions(true);
    };

    const sendWhatsApp = (bill) => {
        const itemsText = bill.items.map(i => {
            if (i.quantity > 1) {
                return `‚Ä¢ ${i.name} (${i.quantity} x ‚Çπ${i.rate}) = ‚Çπ${i.subtotal}`;
            }
            return `‚Ä¢ ${i.name} - ‚Çπ${i.rate}`;
        }).join("\n");

        const msg = 
`SRI VINAYAGA LABER WORKS
Sinthan Nagar, Krishnampalayam, Erode - 03

Bill No: ${bill.billNo}
Customer: ${bill.customer}
Date: ${bill.date}

${itemsText}

TOTAL: ‚Çπ${bill.total}`;
        
        window.open(`https://wa.me/${WHATSAPP_NO}?text=${encodeURIComponent(msg)}`, '_blank');
    };

    const downloadPDF = (bill) => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFontSize(18);
        doc.text("SRI VINAYAGA LABER WORKS", 14, 15);
        doc.setFontSize(10);
        doc.text("Sinthan Nagar, Krishnampalayam, Erode - 03", 14, 22);
        doc.text("Cell: 9095786363, 8015767107", 14, 27);
        
        doc.setFontSize(12);
        doc.text(`Bill No: ${bill.billNo}`, 14, 36);
        doc.text(`Customer: ${bill.customer}`, 14, 42);
        doc.text(`Date: ${bill.date.split(',')[0]}`, 140, 36);
        
        const tableData = bill.items.map(i => [
            i.name,
            i.quantity || 1,
            `‚Çπ${i.rate}`,
            `‚Çπ${i.subtotal || i.rate}`
        ]);
        
        doc.autoTable({
            startY: 48,
            head: [["Item", "Qty", "Rate", "Amount"]],
            body: tableData,
            theme: 'striped',
            headStyles: { fillColor: [34, 197, 94] }
        });
        
        const finalY = doc.lastAutoTable.finalY + 10;
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.text(`Total Amount: ‚Çπ${bill.total}`, 14, finalY);
        
        doc.setFontSize(10);
        doc.text("Thank you for your business!", 14, finalY + 10);
        
        doc.save(`Bill_${bill.billNo}_${bill.customer}.pdf`);
    };

    const handleSendWhatsApp = () => {
        if (currentBill) {
            sendWhatsApp(currentBill);
        }
    };

    const handleDownloadPDF = () => {
        if (currentBill) {
            downloadPDF(currentBill);
        }
    };

    const handleBothActions = () => {
        if (currentBill) {
            downloadPDF(currentBill);
            setTimeout(() => {
                sendWhatsApp(currentBill);
            }, 1000);
        }
    };

    const completeBillProcess = () => {
        setBillNo(billNo + 1);
        setCart([]);
        setCustomer("");
        clearAllQuantities();
        setCurrentBill(null);
        setShowBillOptions(false);
        showNotification("New bill started. Ready to create new order!", 'success');
    };

    const removeFromCart = (index) => {
        setCart(prev => prev.filter((_, i) => i !== index));
        showNotification("Item removed from cart", 'success');
    };

    const updateCartQuantity = (index, change) => {
        setCart(prev => {
            const newCart = [...prev];
            const item = { ...newCart[index] };
            const newQuantity = Math.max(1, (item.quantity || 1) + change);
            item.quantity = newQuantity;
            item.subtotal = item.rate * newQuantity;
            newCart[index] = item;
            return newCart;
        });
    };

    // Get products for current category
    const currentProducts = useMemo(() => {
        if (activeCategory === "bend") return PRODUCTS.bend;
        if (activeCategory === "coupler") return PRODUCTS.coupler;
        return PRODUCTS.jet;
    }, [activeCategory]);

    return (
        <div className="min-h-screen bg-gray-50">
            {/* Notification */}
            {notification && (
                <Notification 
                    message={notification.message} 
                    type={notification.type}
                    onClose={() => setNotification(null)}
                />
            )}

            {/* App Container */}
            <div className="container-padding">
                {/* Hidden owner login trigger */}
                <div 
                    className="hidden-login touch-target" 
                    onClick={() => setShowLogin(true)}
                    title="Owner Login"
                >
                    üîí
                </div>

                {/* Owner Login Modal */}
                {showLogin && !ownerMode && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white p-6 rounded-xl w-full max-w-sm modal-enter">
                            <h3 className="font-black mb-4 text-center text-lg">Owner Login</h3>
                            <input 
                                type="password" 
                                placeholder="Enter Password"
                                value={password} 
                                onChange={e=>setPassword(e.target.value)}
                                className="mb-4"
                                onKeyPress={(e) => e.key === 'Enter' && password === OWNER_PASSWORD && setOwnerMode(true)}
                            />
                            <div className="flex space-x-2">
                                <button 
                                    className="bg-green-600 text-white flex-1 p-3 rounded-lg font-medium"
                                    onClick={() => {
                                        if (password === OWNER_PASSWORD) {
                                            setOwnerMode(true);
                                            setShowLogin(false);
                                            setPassword("");
                                            showNotification("Owner logged in successfully", 'success');
                                        } else {
                                            showNotification("Incorrect password", 'error');
                                        }
                                    }}
                                >
                                    Login
                                </button>
                                <button 
                                    className="bg-gray-300 text-black flex-1 p-3 rounded-lg font-medium"
                                    onClick={() => setShowLogin(false)}
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                )}

                {/* Bill Options Modal */}
                {showBillOptions && currentBill && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white p-6 rounded-xl w-full max-w-sm modal-enter">
                            <h3 className="font-black mb-4 text-center text-lg">üéâ Bill Generated!</h3>
                            <p className="text-center mb-2 font-medium">Bill No: #{currentBill.billNo}</p>
                            <p className="text-center mb-6 text-gray-600">Customer: {currentBill.customer}</p>
                            
                            <div className="space-y-3">
                                <button 
                                    className="bg-gradient-to-r from-green-500 to-blue-500 text-white w-full p-3 rounded-lg font-medium shadow-md"
                                    onClick={handleBothActions}
                                >
                                    üì≤ Send WhatsApp & Download PDF
                                </button>
                                
                                <button 
                                    className="bg-green-600 text-white w-full p-3 rounded-lg font-medium"
                                    onClick={handleSendWhatsApp}
                                >
                                    üì≤ Send via WhatsApp
                                </button>
                                
                                <button 
                                    className="bg-blue-600 text-white w-full p-3 rounded-lg font-medium"
                                    onClick={handleDownloadPDF}
                                >
                                    üì• Download PDF
                                </button>
                                
                                <button 
                                    className="bg-gray-100 text-gray-800 w-full p-3 rounded-lg font-medium border"
                                    onClick={completeBillProcess}
                                >
                                    ‚úÖ Done & New Bill
                                </button>
                            </div>
                        </div>
                    </div>
                )}

                {/* HEADER - English Only */}
                <div className="bg-gradient-to-r from-yellow-400 to-yellow-500 p-4 rounded-xl text-center font-black shadow-lg mb-6">
                    <div className="text-xl md:text-2xl">SRI VINAYAGA LABER WORKS</div>
                    <div className="text-xs md:text-sm font-normal mt-2">
                        Sinthan Nagar, Krishnampalayam, Erode - 03<br/>
                        üìû Cell: 9095786363, 8015767107
                    </div>
                </div>

                {/* OWNER HISTORY */}
                {ownerMode && (
                    <div className="bg-white p-4 rounded-xl shadow mb-6">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="font-black text-lg">üìã Order History</h3>
                            <button 
                                className="text-sm bg-red-500 text-white px-4 py-2 rounded-lg font-medium"
                                onClick={() => {
                                    setOwnerMode(false);
                                    showNotification("Logged out successfully", 'success');
                                }}
                            >
                                Logout
                            </button>
                        </div>
                        {history.length===0 ? (
                            <p className="text-gray-500 text-center py-4">No bills yet</p>
                        ) : (
                            <div className="space-y-3 max-h-80 overflow-y-auto">
                                {history.map(b=>(
                                    <div key={b.billNo} className="border border-gray-200 p-3 rounded-lg">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <div className="font-bold">#{b.billNo}</div>
                                                <div className="text-sm text-gray-600">{b.customer}</div>
                                            </div>
                                            <div className="text-right">
                                                <div className="font-bold text-green-600">‚Çπ{b.total}</div>
                                                <div className="text-xs text-gray-500">{b.date.split(',')[0]}</div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                )}

                {/* CUSTOMER INPUT */}
                <div className="bg-white p-4 rounded-xl shadow mb-6">
                    <label className="block font-medium mb-2">
                        <DualText en="üë§ Customer Name" ta="üë§ ‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç" />
                    </label>
                    <input 
                        placeholder="Enter customer name / ‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç"
                        value={customer} 
                        onChange={e=>setCustomer(e.target.value)}
                        className="text-lg touch-target"
                    />
                </div>

                {/* PRODUCT SELECTION */}
                <div className="bg-white rounded-xl shadow overflow-hidden mb-6">
                    {/* Category Tabs */}
                    <div className="flex border-b">
                        <button
                            className={`flex-1 p-3 font-medium ${activeCategory === "bend" ? "bg-yellow-100 text-yellow-800" : "bg-gray-100"} touch-target`}
                            onClick={() => setActiveCategory("bend")}
                        >
                            üîß <DualText en="BEND" ta="‡Æ™‡ØÜ‡Æ£‡Øç‡Æü‡Øç" />
                        </button>
                        <button
                            className={`flex-1 p-3 font-medium ${activeCategory === "coupler" ? "bg-yellow-100 text-yellow-800" : "bg-gray-100"} touch-target`}
                            onClick={() => setActiveCategory("coupler")}
                        >
                            üîó <DualText en="COUPLER" ta="‡Æï‡Æ™‡Øç‡Æ≤‡Æ∞‡Øç" />
                        </button>
                        <button
                            className={`flex-1 p-3 font-medium ${activeCategory === "jet" ? "bg-yellow-100 text-yellow-800" : "bg-gray-100"} touch-target`}
                            onClick={() => setActiveCategory("jet")}
                        >
                            üíß <DualText en="JET VALVE" ta="‡Æú‡ØÜ‡Æü‡Øç ‡Æµ‡Ææ‡Æ≤‡Øç‡Æµ‡Øç" />
                        </button>
                    </div>

                    {/* Product List */}
                    <div className={`max-h-80 md:max-h-96 overflow-y-auto p-3 ${isMobile ? '' : 'product-grid'}`}>
                        {currentProducts.map((product, index) => {
                            if (activeCategory === "bend" || activeCategory === "coupler") {
                                return Object.entries(product.rates).map(([weight, rate]) => {
                                    const productKey = `${activeCategory}_${product.size}_${weight}`;
                                    const quantity = productQuantities[productKey] || 0;
                                    
                                    return (
                                        <div key={`${product.size}-${weight}`} className="product-card border border-gray-200 rounded-lg p-3 mb-3">
                                            <div className="flex justify-between items-center mb-2">
                                                <div>
                                                    <div className="font-bold">
                                                        {activeCategory === "bend" ? (
                                                            <DualText 
                                                                en={`${product.size}mm BEND`} 
                                                                ta={`${product.size}mm ‡Æ™‡ØÜ‡Æ£‡Øç‡Æü‡Øç`} 
                                                            />
                                                        ) : (
                                                            <DualText 
                                                                en={`${product.size}mm COUPLER`} 
                                                                ta={`${product.size}mm ‡Æï‡Æ™‡Øç‡Æ≤‡Æ∞‡Øç`} 
                                                            />
                                                        )}
                                                    </div>
                                                    <div className="text-sm text-gray-600">{weight}</div>
                                                </div>
                                                <div className="font-bold text-green-600">‚Çπ{rate}</div>
                                            </div>
                                            
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-2">
                                                    <button 
                                                        onClick={() => updateQuantity(productKey, -1)}
                                                        disabled={quantity === 0}
                                                        className={`quantity-btn touch-target ${quantity === 0 ? 'bg-gray-200 text-gray-400' : 'bg-red-100 text-red-600'}`}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <div className="w-10 text-center font-bold">{quantity}</div>
                                                    <button 
                                                        onClick={() => updateQuantity(productKey, 1)}
                                                        className="quantity-btn touch-target bg-green-100 text-green-600"
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                                <div className="text-sm font-medium">
                                                    <DualText en="Subtotal:" ta="‡Æ§‡ØÅ‡Æ£‡Øà‡Æ§‡Øç‡Æ§‡Øä‡Æï‡Øà:" /> <span className="text-blue-600">‚Çπ{rate * quantity}</span>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                });
                            } else {
                                // Jet Valves
                                const productKey = `jet_${product.name}`;
                                const quantity = productQuantities[productKey] || 0;
                                
                                return (
                                    <div key={product.name} className="product-card border border-gray-200 rounded-lg p-3 mb-3">
                                        <div className="flex justify-between items-center mb-2">
                                            <div>
                                                <div className="font-bold">
                                                    <DualText en="JET FOOT VALVE" ta="‡Æú‡ØÜ‡Æü‡Øç ‡ÆÉ‡Æ™‡ØÅ‡Æü‡Øç ‡Æµ‡Ææ‡Æ≤‡Øç‡Æµ‡Øç" />
                                                </div>
                                                <div className="text-sm text-gray-600">{product.name}</div>
                                            </div>
                                            <div className="font-bold text-green-600">‚Çπ{product.rate}</div>
                                        </div>
                                        
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-2">
                                                <button 
                                                    onClick={() => updateQuantity(productKey, -1)}
                                                    disabled={quantity === 0}
                                                    className={`quantity-btn touch-target ${quantity === 0 ? 'bg-gray-200 text-gray-400' : 'bg-red-100 text-red-600'}`}
                                                >
                                                    ‚àí
                                                </button>
                                                <div className="w-10 text-center font-bold">{quantity}</div>
                                                <button 
                                                    onClick={() => updateQuantity(productKey, 1)}
                                                    className="quantity-btn touch-target bg-green-100 text-green-600"
                                                >
                                                    +
                                                </button>
                                            </div>
                                            <div className="text-sm font-medium">
                                                <DualText en="Subtotal:" ta="‡Æ§‡ØÅ‡Æ£‡Øà‡Æ§‡Øç‡Æ§‡Øä‡Æï‡Øà:" /> <span className="text-blue-600">‚Çπ{product.rate * quantity}</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            }
                        })}
                    </div>
                </div>

                {/* Add Selected to Cart Button */}
                <button 
                    onClick={addToCartFromQuantities}
                    className="bg-gradient-to-r from-blue-500 to-purple-600 text-white w-full p-4 rounded-xl font-bold text-lg shadow-lg mb-6 touch-target"
                >
                    üõí <DualText en="Add Selected to Cart" ta="‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡Æ±‡Øç‡Æ±‡Øà ‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øç‡Æü‡Æø‡Æ≤‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç" />
                </button>

                {/* CART */}
                <div className="bg-white rounded-xl shadow-lg p-4 mb-24 md:mb-6">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="font-black text-lg">
                            üõçÔ∏è <DualText en={`Cart (${cart.length} items)`} ta={`‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øç (${cart.length} ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øç)`} />
                        </h3>
                        <div className="font-bold text-green-600 text-lg">‚Çπ{total}</div>
                    </div>
                    
                    <div className="max-h-48 overflow-y-auto mb-4">
                        {cart.length === 0 ? (
                            <p className="text-gray-500 text-center py-4">
                                <DualText en="Cart is empty" ta="‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æï‡Ææ‡Æ≤‡Æø‡ÆØ‡Ææ‡Æï ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ" />
                            </p>
                        ) : (
                            <div className="space-y-2">
                                {cart.map((item, index) => (
                                    <div key={index} className="cart-item bg-gray-50 p-3 rounded-lg">
                                        <div className="flex justify-between items-start">
                                            <div className="flex-1">
                                                <div className="font-medium text-sm">{item.name}</div>
                                                <div className="text-xs text-gray-600">
                                                    <DualText en={`‚Çπ${item.rate} each`} ta={`‚Çπ${item.rate} ‡Æí‡Æµ‡Øç‡Æµ‡Øä‡Æ©‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç`} />
                                                </div>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <div className="flex items-center space-x-1">
                                                    <button 
                                                        onClick={() => updateCartQuantity(index, -1)}
                                                        className="w-8 h-8 rounded-full bg-gray-200 text-sm touch-target"
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <span className="font-bold w-6 text-center">{item.quantity || 1}</span>
                                                    <button 
                                                        onClick={() => updateCartQuantity(index, 1)}
                                                        className="w-8 h-8 rounded-full bg-gray-200 text-sm touch-target"
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                                <div className="font-bold w-20 text-right">‚Çπ{item.subtotal || item.rate}</div>
                                                <button 
                                                    onClick={() => removeFromCart(index)}
                                                    className="text-red-500 text-lg touch-target p-1"
                                                >
                                                    √ó
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    
                    <button 
                        onClick={generateBill}
                        disabled={!customer || cart.length === 0}
                        className={`w-full p-4 rounded-xl font-bold text-lg touch-target ${
                            !customer || cart.length === 0 
                                ? 'bg-gray-300 text-gray-500' 
                                : 'bg-gradient-to-r from-green-500 to-green-600 text-white shadow-lg'
                        }`}
                    >
                        {!customer ? (
                            <DualText en="Enter Customer Name" ta="‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç" />
                        ) : cart.length === 0 ? (
                            <DualText en="Add Items to Cart" ta="‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øç‡Æü‡Æø‡Æ≤‡Øç ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç" />
                        ) : (
                            <span>üí∞ <DualText en="Generate Bill" ta="‡Æ™‡Æø‡Æ≤‡Øç ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ" /></span>
                        )}
                    </button>
                </div>
            </div>

            {/* Mobile bottom spacing */}
            {isMobile && <div className="h-8"></div>}
        </div>
    );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>

<!-- Create manifest.json content -->
<script>
// Create manifest dynamically
const manifest = {
    "name": "Sri Vinayaga Laber Works",
    "short_name": "Laber Works",
    "description": "Billing system for Sri Vinayaga Laber Works",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#fbbf24",
    "theme_color": "#fbbf24",
    "orientation": "portrait",
    "icons": [
        {
            "src": "icon-72.png",
            "sizes": "72x72",
            "type": "image/png"
        },
        {
            "src": "icon-96.png",
            "sizes": "96x96",
            "type": "image/png"
        },
        {
            "src": "icon-128.png",
            "sizes": "128x128",
            "type": "image/png"
        },
        {
            "src": "icon-144.png",
            "sizes": "144x144",
            "type": "image/png"
        },
        {
            "src": "icon-152.png",
            "sizes": "152x152",
            "type": "image/png"
        },
        {
            "src": "icon-192.png",
            "sizes": "192x192",
            "type": "image/png"
        },
        {
            "src": "icon-384.png",
            "sizes": "384x384",
            "type": "image/png"
        },
        {
            "src": "icon-512.png",
            "sizes": "512x512",
            "type": "image/png"
        }
    ]
};

// Create and set manifest
const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
const manifestURL = URL.createObjectURL(manifestBlob);
document.querySelector('link[rel="manifest"]').href = manifestURL;
</script>
</body>
</html>
