<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sri Vinayaga Laber Works</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<style>
body { font-family: system-ui; background:#f8fafc; }
select, input { width:100%; padding:10px; border-radius:10px; margin-bottom:8px; }
button { border-radius:12px; }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useMemo } = React;

/* ðŸ” OWNER */
const OWNER_PASSWORD = "6363";
const WHATSAPP_NO = "918643861100";

/* ðŸ“¦ PRODUCTS (EXACT FROM EXCEL â€“ UNCHANGED) */
const PRODUCTS = {
  bend: [
    { size: 20, rates: { "15 Kgs": 1.40 } },
    { size: 25, rates: { "10 Kgs": 1.50, "15 Kgs": 2.00 } },
    { size: 32, rates: { "10 Kgs": 2.50, "15 Kgs": 2.80 } },
    { size: 40, rates: { "6 Kgs": 3.00, "10 Kgs": 4.00, "15 Kgs": 3.70 } },
    { size: 50, rates: { "6 Kgs": 4.00, "10 Kgs": 6.00, "15 Kgs": 4.95, "S-Bend": 8.00 } },
    { size: 63, rates: { "4 Kgs": 6.50, "6 Kgs": 7.00, "S-Bend": 9.00 } },
    { size: 75, rates: { "4 Kgs": 7.50, "6 Kgs": 8.60, "S-Bend": 10.00 } },
    { size: 90, rates: { "4 Kgs": 9.50, "6 Kgs": 11.50, "S-Bend": 13.00 } },
    { size: 110, rates: { "4 Kgs": 13.50, "6 Kgs": 15.00, "S-Bend": 17.00 } },
    { size: 140, rates: { "4 Kgs": 65.00, "6 Kgs": 80.00, "S-Bend": 115.00 } },
    { size: 160, rates: { "4 Kgs": 100.00, "6 Kgs": 115.00, "S-Bend": 172.50 } },
    { size: 180, rates: { "4 Kgs": 170.00, "6 Kgs": 195.50 } },
    { size: 200, rates: { "4 Kgs": 220.00, "6 Kgs": 245.50 } }
  ],
  coupler: [
    { size: 20, rates: { "15 Kgs": 1.00 } },
    { size: 25, rates: { "10 Kgs": 1.15, "15 Kgs": 1.30 } },
    { size: 32, rates: { "10 Kgs": 1.40, "15 Kgs": 1.50 } },
    { size: 40, rates: { "6 Kgs": 2.00, "10 Kgs": 2.30, "15 Kgs": 2.35 } },
    { size: 50, rates: { "6 Kgs": 2.30, "10 Kgs": 2.50 } },
    { size: 63, rates: { "4 Kgs": 3.00, "6 Kgs": 3.45 } },
    { size: 75, rates: { "4 Kgs": 3.45, "6 Kgs": 4.00 } },
    { size: 90, rates: { "4 Kgs": 4.50, "6 Kgs": 5.20 } },
    { size: 110, rates: { "4 Kgs": 5.20, "6 Kgs": 6.30 } },
    { size: 140, rates: { "4 Kgs": 8.60, "6 Kgs": 9.00 } },
    { size: 160, rates: { "4 Kgs": 11.50, "6 Kgs": 12.65 } }
  ],
  jet: [
    { name: "50*6", rate: 30 },
    { name: "50*15", rate: 35 },
    { name: "50*32", rate: 45 },
    { name: "50*40", rate: 55 },
    { name: "63*6", rate: 45 },
    { name: "63*15", rate: 55 }
  ]
};

function App() {
  const [cart, setCart] = useState([]);
  const [customer, setCustomer] = useState("");
  const [history, setHistory] = useState([]);
  const [billNo, setBillNo] = useState(1001);

  const [ownerMode, setOwnerMode] = useState(false);
  const [password, setPassword] = useState("");

  const addItem = (name, rate) => {
    setCart(c => [...c, { name, rate }]);
  };

  const total = useMemo(() =>
    cart.reduce((s,i)=>s+i.rate,0), [cart]);

  const generateBill = () => {
    if (!customer || cart.length === 0) return;

    const bill = {
      billNo,
      customer,
      items: cart,
      total,
      date: new Date().toLocaleString()
    };

    setHistory(h => [bill, ...h]);
    setBillNo(billNo + 1);

    sendWhatsApp(bill);
    downloadPDF(bill);

    setCart([]);
    setCustomer("");
  };

  const sendWhatsApp = (bill) => {
    const msg =
`SRI VINAYAGA LABER WORKS
SINTHAN NAGAR, KRISHNAMPALAYAM, ERODE - 03

Bill No: ${bill.billNo}
Customer: ${bill.customer}

${bill.items.map(i=>`â€¢ ${i.name} - â‚¹${i.rate}`).join("\n")}

TOTAL: â‚¹${bill.total}`;
    window.open(`https://wa.me/${WHATSAPP_NO}?text=${encodeURIComponent(msg)}`);
  };

  const downloadPDF = (bill) => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("SRI VINAYAGA LABER WORKS", 14, 15);
    doc.text(`Bill No: ${bill.billNo}`, 14, 22);
    doc.text(`Customer: ${bill.customer}`, 14, 28);
    doc.autoTable({
      startY: 36,
      head: [["Item","Rate"]],
      body: bill.items.map(i=>[i.name, i.rate])
    });
    doc.text(`Total: â‚¹${bill.total}`, 14, doc.lastAutoTable.finalY + 10);
    doc.save(`Bill_${bill.billNo}.pdf`);
  };

  return (
    <div className="max-w-md mx-auto p-4 space-y-4">

      {/* HEADER */}
      <div className="bg-yellow-400 p-4 rounded-xl text-center font-black">
        SRI VINAYAGA LABER WORKS
        <div className="text-xs font-normal">
          SINTHAN NAGAR, KRISHNAMPALAYAM, ERODE - 03<br/>
          CELL: 9095786363, 8015767107
        </div>
      </div>

      {/* OWNER LOGIN */}
      {!ownerMode && (
        <div className="bg-white p-4 rounded-xl">
          <input type="password" placeholder="Owner Password"
            value={password} onChange={e=>setPassword(e.target.value)} />
          <button className="bg-black text-white w-full p-2"
            onClick={()=>password===OWNER_PASSWORD && setOwnerMode(true)}>
            Owner Login
          </button>
        </div>
      )}

      {/* OWNER HISTORY */}
      {ownerMode && (
        <div className="bg-white p-4 rounded-xl">
          <h3 className="font-black mb-2">Order History</h3>
          {history.length===0 && <p className="text-sm">No bills yet</p>}
          {history.map(b=>(
            <div key={b.billNo} className="border-b py-1 text-sm">
              #{b.billNo} | {b.customer} | â‚¹{b.total}
            </div>
          ))}
        </div>
      )}

      {/* CUSTOMER */}
      <input placeholder="Customer Name"
        value={customer} onChange={e=>setCustomer(e.target.value)} />

      {/* PRODUCTS */}
      <h3 className="font-black">BEND</h3>
      {PRODUCTS.bend.map(b =>
        Object.entries(b.rates).map(([w,r])=>(
          <button key={b.size+w}
            className="bg-white w-full p-2 mb-1"
            onClick={()=>addItem(`${b.size}mm Bend ${w}`, r)}>
            {b.size}mm Bend {w} â€“ â‚¹{r}
          </button>
        ))
      )}

      <h3 className="font-black">COUPLER</h3>
      {PRODUCTS.coupler.map(c =>
        Object.entries(c.rates).map(([w,r])=>(
          <button key={c.size+w}
            className="bg-white w-full p-2 mb-1"
            onClick={()=>addItem(`${c.size}mm Coupler ${w}`, r)}>
            {c.size}mm Coupler {w} â€“ â‚¹{r}
          </button>
        ))
      )}

      <h3 className="font-black">JET FOOT VALVE</h3>
      {PRODUCTS.jet.map(j=>(
        <button key={j.name}
          className="bg-white w-full p-2 mb-1"
          onClick={()=>addItem(`Jet ${j.name}`, j.rate)}>
          Jet {j.name} â€“ â‚¹{j.rate}
        </button>
      ))}

      {/* CART */}
      <div className="bg-white p-4 rounded-xl">
        {cart.map((i,idx)=>(
          <div key={idx} className="flex justify-between">
            <span>{i.name}</span>
            <span>â‚¹{i.rate}</span>
          </div>
        ))}
        <div className="font-black text-right mt-2">
          Total â‚¹{total}
        </div>
      </div>

      <button onClick={generateBill}
        className="bg-green-600 text-white w-full p-3 rounded-xl">
        Generate Bill
      </button>

    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
