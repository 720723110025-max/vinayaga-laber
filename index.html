<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sri Vinayaga Laber Works</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        .cart-animation { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1rem; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, doc, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "",
            authDomain: "default-app-id.firebaseapp.com",
            projectId: "default-app-id",
            storageBucket: "default-app-id.appspot.com",
            messagingSenderId: "",
            appId: ""
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.fb = { app, auth, db, collection, doc, addDoc, onSnapshot, query, orderBy, serverTimestamp, signInAnonymously, onAuthStateChanged, signInWithCustomToken };
        window.dispatchEvent(new Event('firebase-ready'));
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const PRODUCT_DATA = {
            pipes: [
                { size: 20, pieces: 40, rates: { "10 Kgs": 1.15, "15 Kgs": 1.20 } },
                { size: 25, pieces: 38, rates: { "10 Kgs": 1.44, "15 Kgs": 1.70 } },
                { size: 32, pieces: 30, rates: { "10 Kgs": 2.30, "15 Kgs": 2.50 } },
                { size: 40, pieces: 26, rates: { "6 Kgs": 2.50, "10 Kgs": 3.50, "15 Kgs": 3.50 } },
                { size: 50, pieces: 20, rates: { "6 Kgs": 4.00, "10 Kgs": 4.50, "15 Kgs": 4.50, "5 Bend": 6.10 } },
                { size: 63, pieces: 17, rates: { "4 Kgs": 5.00, "6 Kgs": 6.00, "5 Bend": 6.90 } },
                { size: 75, pieces: 15, rates: { "4 Kgs": 6.00, "6 Kgs": 7.00, "5 Bend": 8.70 } },
                { size: 90, pieces: 13, rates: { "4 Kgs": 8.00, "6 Kgs": 9.00, "5 Bend": 10.62 } },
                { size: 110, pieces: 11, rates: { "4 Kgs": 11.00, "6 Kgs": 12.65, "5 Bend": 12.65 } },
                { size: 140, pieces: 8, rates: { "4 Kgs": 65.00, "6 Kgs": 80.00, "5 Bend": 115.00 } },
                { size: 160, pieces: 6, rates: { "4 Kgs": 100.00, "6 Kgs": 115.00, "5 Bend": 172.50 } },
                { size: 180, pieces: 5, rates: { "4 Kgs": 170.00, "6 Kgs": 195.50 } },
                { size: 200, pieces: 5, rates: { "4 Kgs": 220.00, "6 Kgs": 245.50 } },
            ],
            jetFootvale: [
                { name: "50*6", rate: 25.00 },
                { name: "50*15", rate: 30.00 },
                { name: "50*32", rate: 30.00 },
                { name: "50*40", rate: 40.00 },
                { name: "63*6", rate: 40.00 },
            ],
            longCoupler: [
                { size: 32, rates: { "10 KG": 4.00, "15 KG": 5.00 } },
                { size: 40, rates: { "6 KG": 4.00, "10 KG": 5.00 } },
                { size: 50, rates: { "6 KG": 5.00 } },
                { size: 63, rates: { "4 KG": 6.50, "6 KG": 7.00 } },
                { size: 75, rates: { "4 KG": 7.50, "6 KG": 8.00 } },
                { size: 90, rates: { "4 KG": 8.50, "6 KG": 9.00 } },
                { size: 110, rates: { "4 KG": 9.50, "6 KG": 10.00 } },
                { size: 140, rates: { "4 KG": 15.50, "6 KG": 18.00 } },
                { size: 160, rates: { "4 KG": 18.50, "6 KG": 20.00 } },
            ]
        };

        const UI_TEXT = {
            ta: {
                title: "ஸ்ரீ விநாயகா லேபர் ஒர்க்ஸ்",
                subtitle: "ஸ்ரீ பச்சையம்மன் துணை",
                pvcPipes: "PVC பெண்ட்",
                jetFootvale: "ஜெட் புட்வால்வ்",
                longCoupler: "லாங் கப்ளர்",
                add: "பில்லில் சேர்க்க",
                total: "மொத்த தொகை",
                checkout: "பில் அனுப்பவும்",
                namePlaceholder: "வாடிக்கையாளர் பெயர்",
                shop: "கடை",
                records: "பதிவுகள்",
                itemsInCart: "பொருட்கள்",
                emptyCart: "பட்டியல் காலியாக உள்ளது"
            }
        };

        const Icon = ({ name, className = "" }) => {
            const icons = {
                shopping: <><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></>,
                records: <><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 7h10"/><path d="M7 12h10"/><path d="M7 17h10"/></>,
                plus: <path d="M12 5v14M5 12h14"/>,
                send: <><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></>,
                trash: <><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></>,
                chevron: <path d="m6 9 6 6 6-6"/>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        function App() {
            const [view, setView] = useState('shop');
            const [user, setUser] = useState(null);
            const [cart, setCart] = useState([]);
            const [customerName, setCustomerName] = useState('');
            const [isCheckingOut, setIsCheckingOut] = useState(false);
            const [isAdmin, setIsAdmin] = useState(false);
            const [pass, setPass] = useState('');
            const [orders, setOrders] = useState([]);

            // Selection States
            const [pSize, setPSize] = useState(PRODUCT_DATA.pipes[0].size);
            const [pWeight, setPWeight] = useState(Object.keys(PRODUCT_DATA.pipes[0].rates)[0]);
            const [jName, setJName] = useState(PRODUCT_DATA.jetFootvale[0].name);
            const [cSize, setCSize] = useState(PRODUCT_DATA.longCoupler[0].size);
            const [cWeight, setCWeight] = useState(Object.keys(PRODUCT_DATA.longCoupler[0].rates)[0]);

            const T = UI_TEXT.ta;
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'v-laber-works-v1';

            useEffect(() => {
                const init = async () => {
                    const { auth, signInAnonymously, onAuthStateChanged } = window.fb;
                    await signInAnonymously(auth);
                    onAuthStateChanged(auth, setUser);
                };
                if (window.fb) init();
                else window.addEventListener('firebase-ready', init);
            }, []);

            useEffect(() => {
                if (!user || !isAdmin || view !== 'records') return;
                const { db, collection, query, orderBy, onSnapshot } = window.fb;
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), orderBy('createdAt', 'desc'));
                return onSnapshot(q, (s) => setOrders(s.docs.map(d => ({id: d.id, ...d.data()}))), (e) => console.error(e));
            }, [user, isAdmin, view]);

            const addToCart = (id, label, rate) => {
                setCart(curr => {
                    const exists = curr.find(i => i.id === id);
                    if (exists) return curr.map(i => i.id === id ? {...i, qty: i.qty + 1} : i);
                    return [...curr, { id, label, rate, qty: 1 }];
                });
            };

            const removeFromCart = (id) => setCart(c => c.filter(i => i.id !== id));

            const grandTotal = useMemo(() => cart.reduce((acc, i) => acc + (i.rate * i.qty), 0), [cart]);

            const handleCheckout = async () => {
                if (!customerName.trim()) { alert("வாடிக்கையாளர் பெயரை உள்ளிடவும்"); return; }
                setIsCheckingOut(true);
                try {
                    const { db, collection, addDoc, serverTimestamp } = window.fb;
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), {
                        customerName, items: cart, total: grandTotal, createdAt: serverTimestamp(), userId: user.uid
                    });
                    const msg = `*SRI VINAYAGA LABER WORKS*\n*Customer:* ${customerName}\n*Total:* ₹${grandTotal}\n\n*Items:*\n${cart.map(i => `- ${i.label} (x${i.qty}): ₹${i.rate*i.qty}`).join('\n')}`;
                    window.open(`https://wa.me/918643861100?text=${encodeURIComponent(msg)}`);
                    setCart([]); setCustomerName('');
                } catch (e) { console.error("Error: " + e.message); }
                setIsCheckingOut(false);
            };

            return (
                <div className="flex flex-col min-h-screen">
                    <header className="bg-yellow-400 p-6 pt-8 text-center shadow-lg sticky top-0 z-40">
                        <p className="text-[10px] font-bold tracking-[0.2em] opacity-80 uppercase mb-1">{T.subtitle}</p>
                        <h1 className="text-2xl font-black tracking-tight">{T.title}</h1>
                    </header>

                    <main className="flex-1 p-4 pb-48 max-w-2xl mx-auto w-full space-y-6">
                        {view === 'shop' ? (
                            <>
                                {/* PVC Pipe Selection */}
                                <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100">
                                    <div className="flex items-center gap-3 mb-5">
                                        <div className="bg-yellow-100 text-yellow-700 p-2.5 rounded-xl"><Icon name="shopping" /></div>
                                        <h2 className="font-extrabold text-lg uppercase tracking-tight">{T.pvcPipes}</h2>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div className="space-y-1">
                                            <p className="text-[10px] font-bold text-slate-400 uppercase px-1">Size</p>
                                            <select className="w-full bg-slate-50 border-none rounded-2xl p-4 font-bold appearance-none cursor-pointer" value={pSize} onChange={e => {setPSize(Number(e.target.value)); setPWeight(Object.keys(PRODUCT_DATA.pipes.find(p=>p.size === Number(e.target.value)).rates)[0])}}>
                                                {PRODUCT_DATA.pipes.map(p => <option key={p.size} value={p.size}>{p.size}mm</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1">
                                            <p className="text-[10px] font-bold text-slate-400 uppercase px-1">Weight</p>
                                            <select className="w-full bg-slate-50 border-none rounded-2xl p-4 font-bold appearance-none cursor-pointer" value={pWeight} onChange={e => setPWeight(e.target.value)}>
                                                {Object.keys(PRODUCT_DATA.pipes.find(p=>p.size === pSize).rates).map(w => <option key={w} value={w}>{w}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <button onClick={() => addToCart(`p-${pSize}-${pWeight}`, `${pSize}mm Bend (${pWeight})`, PRODUCT_DATA.pipes.find(p=>p.size === pSize).rates[pWeight])} className="w-full bg-yellow-400 hover:bg-yellow-500 active:scale-95 transition-all p-4 rounded-2xl font-black flex items-center justify-center gap-2 shadow-sm">
                                        <Icon name="plus" /> {T.add} (₹{PRODUCT_DATA.pipes.find(p=>p.size === pSize).rates[pWeight]})
                                    </button>
                                </div>

                                {/* Jet Footvale */}
                                <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100">
                                    <div className="flex items-center gap-3 mb-5">
                                        <div className="bg-blue-100 text-blue-700 p-2.5 rounded-xl"><Icon name="shopping" /></div>
                                        <h2 className="font-extrabold text-lg uppercase tracking-tight">{T.jetFootvale}</h2>
                                    </div>
                                    <div className="space-y-1 mb-4">
                                        <p className="text-[10px] font-bold text-slate-400 uppercase px-1">Select Model</p>
                                        <select className="w-full bg-slate-50 border-none rounded-2xl p-4 font-bold appearance-none cursor-pointer" value={jName} onChange={e => setJName(e.target.value)}>
                                            {PRODUCT_DATA.jetFootvale.map(j => <option key={j.name} value={j.name}>{j.name}</option>)}
                                        </select>
                                    </div>
                                    <button onClick={() => addToCart(`j-${jName}`, `Jet Footvale ${jName}`, PRODUCT_DATA.jetFootvale.find(j=>j.name===jName).rate)} className="w-full bg-blue-600 text-white hover:bg-blue-700 active:scale-95 transition-all p-4 rounded-2xl font-black flex items-center justify-center gap-2 shadow-sm">
                                        <Icon name="plus" /> {T.add} (₹{PRODUCT_DATA.jetFootvale.find(j=>j.name===jName).rate})
                                    </button>
                                </div>

                                {/* Long Coupler */}
                                <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100">
                                    <div className="flex items-center gap-3 mb-5">
                                        <div className="bg-purple-100 text-purple-700 p-2.5 rounded-xl"><Icon name="shopping" /></div>
                                        <h2 className="font-extrabold text-lg uppercase tracking-tight">{T.longCoupler}</h2>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div className="space-y-1">
                                            <p className="text-[10px] font-bold text-slate-400 uppercase px-1">Size</p>
                                            <select className="w-full bg-slate-50 border-none rounded-2xl p-4 font-bold appearance-none cursor-pointer" value={cSize} onChange={e => {setCSize(Number(e.target.value)); setCWeight(Object.keys(PRODUCT_DATA.longCoupler.find(p=>p.size === Number(e.target.value)).rates)[0])}}>
                                                {PRODUCT_DATA.longCoupler.map(p => <option key={p.size} value={p.size}>{p.size}mm</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1">
                                            <p className="text-[10px] font-bold text-slate-400 uppercase px-1">Weight</p>
                                            <select className="w-full bg-slate-50 border-none rounded-2xl p-4 font-bold appearance-none cursor-pointer" value={cWeight} onChange={e => setCWeight(e.target.value)}>
                                                {Object.keys(PRODUCT_DATA.longCoupler.find(p=>p.size === cSize).rates).map(w => <option key={w} value={w}>{w}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <button onClick={() => addToCart(`c-${cSize}-${cWeight}`, `${cSize}mm Long Coupler (${cWeight})`, PRODUCT_DATA.longCoupler.find(p=>p.size === cSize).rates[cWeight])} className="w-full bg-purple-600 text-white hover:bg-purple-700 active:scale-95 transition-all p-4 rounded-2xl font-black flex items-center justify-center gap-2 shadow-sm">
                                        <Icon name="plus" /> {T.add} (₹{PRODUCT_DATA.longCoupler.find(p=>p.size === cSize).rates[cWeight]})
                                    </button>
                                </div>
                            </>
                        ) : (
                            <div className="space-y-6">
                                {!isAdmin ? (
                                    <div className="bg-white p-8 rounded-[2.5rem] text-center space-y-6 shadow-sm mt-10">
                                        <h3 className="text-xl font-black">Admin Login</h3>
                                        <input type="password" placeholder="Passcode" className="w-full p-4 rounded-2xl bg-slate-100 font-bold text-center outline-none border-2 border-transparent focus:border-yellow-400" value={pass} onChange={e=>setPass(e.target.value)}/>
                                        <button onClick={() => pass === "1234" ? setIsAdmin(true) : alert("தவறான கடவுச்சொல்")} className="w-full bg-slate-900 text-white p-4 rounded-2xl font-black">Unlock</button>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <div className="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm">
                                            <h3 className="font-black text-slate-400 uppercase text-xs tracking-widest">Sales History</h3>
                                            <button onClick={()=>setIsAdmin(false)} className="text-xs font-bold text-red-500 uppercase">Logout</button>
                                        </div>
                                        {orders.map(o => (
                                            <div key={o.id} className="bg-white p-5 rounded-2xl shadow-sm space-y-3">
                                                <div className="flex justify-between items-start">
                                                    <div>
                                                        <p className="font-black text-lg">{o.customerName}</p>
                                                        <p className="text-[10px] font-bold text-slate-400">{o.createdAt?.toDate().toLocaleString()}</p>
                                                    </div>
                                                    <p className="text-xl font-black text-green-600">₹{o.total}</p>
                                                </div>
                                                <div className="bg-slate-50 p-3 rounded-xl space-y-1">
                                                    {o.items?.map((i,idx) => <p key={idx} className="text-[10px] font-bold text-slate-500 flex justify-between"><span>{i.qty}x {i.label}</span><span>₹{i.rate*i.qty}</span></p>)}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Fixed Cart Footer */}
                    {cart.length > 0 && view === 'shop' && (
                        <div className="fixed bottom-24 left-4 right-4 bg-slate-900 text-white p-6 rounded-[2.5rem] shadow-2xl space-y-4 z-50 cart-animation">
                            <div className="flex justify-between items-center border-b border-white/10 pb-4">
                                <p className="text-[10px] font-black uppercase tracking-widest opacity-50">{T.itemsInCart} ({cart.reduce((a, b) => a + b.qty, 0)})</p>
                                <button onClick={()=>setCart([])} className="text-white/40 hover:text-white"><Icon name="trash" /></button>
                            </div>
                            <div className="max-h-32 overflow-y-auto space-y-2 pr-2">
                                {cart.map(item => (
                                    <div key={item.id} className="flex justify-between items-center text-xs font-bold">
                                        <span className="opacity-80 truncate mr-2">{item.qty}x {item.label}</span>
                                        <div className="flex items-center gap-3">
                                            <span>₹{item.rate * item.qty}</span>
                                            <button onClick={() => removeFromCart(item.id)} className="text-red-400"><Icon name="trash" className="w-3 h-3" /></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <div className="pt-2 flex justify-between items-end">
                                <span className="text-[10px] font-black opacity-50 uppercase">{T.total}</span>
                                <span className="text-2xl font-black text-yellow-400">₹{grandTotal}</span>
                            </div>
                            <div className="flex flex-col gap-3">
                                <input className="w-full bg-white/10 border border-white/10 p-4 rounded-2xl outline-none focus:bg-white/20 font-bold placeholder:text-white/20 text-white" placeholder={T.namePlaceholder} value={customerName} onChange={e=>setCustomerName(e.target.value)} />
                                <button onClick={handleCheckout} disabled={isCheckingOut} className="w-full bg-green-500 p-4 rounded-2xl font-black flex items-center justify-center gap-2 hover:bg-green-400 active:scale-95 disabled:opacity-50 text-slate-900">
                                    <Icon name="send" /> {T.checkout}
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Bottom Navigation */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 flex items-center justify-around h-20 px-10 z-50">
                        <button onClick={() => setView('shop')} className={`flex flex-col items-center gap-1 transition-all ${view === 'shop' ? 'text-yellow-600 scale-110' : 'text-slate-300'}`}>
                            <Icon name="shopping" />
                            <span className="text-[10px] font-black uppercase tracking-tighter">{T.shop}</span>
                        </button>
                        <button onClick={() => setView('records')} className={`flex flex-col items-center gap-1 transition-all ${view === 'records' ? 'text-yellow-600 scale-110' : 'text-slate-300'}`}>
                            <Icon name="records" />
                            <span className="text-[10px] font-black uppercase tracking-tighter">{T.records}</span>
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
